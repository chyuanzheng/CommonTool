#include "stdAfx.h"
#include "CommonWnd.h"
#define  DEF_WNDCLASS    L"dfdf"


/////////////////////////////////////////////////////////////////////////
// CPopupWnd message map and member functions

//SetWindowPos(&CWnd::wndTopMost ,0,0,480,272,SWP_SHOWWINDOW);
const RECT IM_MAIN_RECT = {550,330,700,480};//左边的 退出按键 {0,0,480,272};//左边的 退出按键

CWnd *CPopupWnd::m_pWindow=NULL;
CPopupWnd::CPopupWnd ()
{

	static BOOL bReg = 0;

	if(!bReg)//保证只注册一次
	{
		RegisterWindow( DEF_WNDCLASS,CPopupWnd::WndProc );
		bReg = 1;
	}

	if ( Create( DEF_WNDCLASS, L"popup_wnd", WS_POPUP, IM_MAIN_RECT, AfxGetHWND()))
	{
		AfxSetPopupDcRect(IM_MAIN_RECT);
		AfxSetPopupHWND(m_hWnd);
		m_pWindow = this;
	}
}
CPopupWnd::~CPopupWnd ()
{

}
void CPopupWnd::PostNcDestroy()
{
	// TODO: 在此添加专用代码和/或调用基类
	CWnd::PostNcDestroy();
	delete this;
}

LRESULT CALLBACK CPopupWnd::WndProc(HWND hWnd, UINT nMsg, WPARAM wParam, LPARAM lParam)
{
	//调用窗口类的回调函数
	if(m_pWindow == NULL)
	{
		return ::DefWindowProc(hWnd, nMsg, wParam, lParam);;
	}


	switch( nMsg )
	{
	case WM_ERASEBKGND://不需要刷背景
		return 0;
	case WM_EXIT_PROSS:
		return ::DestroyWindow(m_pWindow->GetHWnd());
	case WM_DESTROY://
		PostQuitMessage(m_pWindow->GetExitCode());
		//#ifndef CH_CE_DEBUG
		//	   return 0; 
		//   case WM_NCDESTROY:
		//#endif
		m_pWindow->PostNcDestroy();
		return 0; 
	default:
		break;
	}

	return m_pWindow->WindowProc( nMsg, wParam, lParam );
}

Activity * CPopupWnd::GetWndActivity()
{
	return Activity::GetPopupActiveActiviy();
}
